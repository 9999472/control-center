language: cpp
branches:
  only:
  - master
  - dev
env:
  global:
  - secure: IpKCNNy3ouxKFbDSVAa7TxnwmPzX63ND7n3VxYVHECPVi2Kk8Yod73i3Bjro5ch5niNJLpeDm3RDS0yZq1QdYhex0xxdoB1VLa9a1GqrGZ/trrKTdvQeN93lR6c2Y3dRLydDPg19qzJcIM/qqJa4uTWHxYN+k7ulB83ymv2dnTAVrdzpZ4+XwGE8Dn48oVmu9lR8w5DbYjv+ETFnZzmnNTW+195qn3CgSz1FQ1+s0ymi+EnCR7g1IptQY7WXFyKz/NBpLo4dcEbX3MwPsJh4aI7YwreeQYCG1aVv+9jQaF31gblhRH0MHObxX1k5ou3fh+Ir+ltgqYVBAiHq4FPHoNS2BJUAm7KqQW8C2o+cPmOKxhybeZ5WZS3uMxzDlYfUz/YDcJRQJbLgYlGSxQSSzaDmsi3gzbA/IHrHQmTLsMuUsUe8Jeszhz6QCMwGHGOFhr2T5v6p9ofRdn8QKOggyR8e/22dDnGjMFDgxd5eT8d5KRHIWnJIszI9gOnZVE5GLUmO2viYY0X7PQ+w79lirmfVeBbsIqHumsjd09ROd4EEayX6xxQLB8DBdazySlaDpAKvMD6zCk5O0o3xEZyOjiXUAMpmB4iwnl+hzWN1vQkin3ILedPru3mPFHs4ID3A8hW38+6wAp81pGemu1Fc+P2fRi2O7purSF/UUk4nGJQ=
matrix:
  include:
  - os: linux
    dist: trusty
    sudo: required
    before_install:
    - openssl aes-256-cbc -k "$decrypt_key" -in /home/travis/build/subutai-io/control-center/travis.gpg.enc
      -out /home/travis/build/subutai-io/control-center/travis.gpg -d
    - gpg --allow-secret-key-import --import /home/travis/build/subutai-io/control-center/travis.gpg
      && rm -f /home/travis/build/subutai-io/control-center/travis.gpg
    - LD_LIBRARY_PATH=/usr/local/lib64/:$LD_LIBRARY_PATH
    - export LD_LIBRARY_PATH
    - sudo apt-add-repository --yes ppa:ubuntu-toolchain-r/test
    - sudo apt-get update
    - sudo apt-get install gcc-4.9 g++-4.9 libicu52 devscripts libssh2-1-dev libxi-dev
      libxcb-xkb-dev libxrender-dev libxcb-image0-dev libxcb-render-util0-dev libxcb-icccm4-dev
      libxcb-keysyms1-dev libxcb-xinerama0-dev libdconf-dbus-1-dev dh-autoreconf
    script:
    - sudo mkdir -p /home/builder/ && sudo chmod 777 /home/builder/
    - wget -nv -O /home/builder/qt_static.tar.gz https://cdn.subutai.io:8338/kurjun/rest/raw/download?name=qt_static.tar.gz
      && tar -xf /home/builder/qt_static.tar.gz -C /home/builder/
    - sudo /home/travis/build/subutai-io/control-center/./build_linux.sh $TRAVIS_BRANCH
    - ls subutai_control_center_bin
    deploy:
    - provider: script
      script: bash upload.sh $TRAVIS_BRANCH
      skip_cleanup: true
      on:
        branch: dev
    - provider: script
      script: bash upload.sh $TRAVIS_BRANCH
      skip_cleanup: true
      on:
        branch: master
    - provider: script
      script: bash upload.sh HEAD
      skip_cleanup: true
      on:
        tags: true
  - os: osx
    osx_image: xcode9
    before_install:
    - openssl aes-256-cbc -k "$decrypt_key" -in /Users/travis/build/subutai-io/control-center/travis.gpg.enc
      -out /Users/travis/build/subutai-io/control-center/travis.gpg -d
    - gpg --allow-secret-key-import --import /Users/travis/build/subutai-io/control-center/travis.gpg
      && rm -f /Users/travis/build/subutai-io/control-center/travis.gpg
    - brew update
    - brew install libssh2
    script:
    - wget -nv -O /tmp/Qt5.9.2.tar.gz https://cdn.subutai.io:8338/kurjun/rest/raw/download?name=Qt5.9.2.tar.gz
      && tar -xf /tmp/Qt5.9.2.tar.gz -C /tmp
    - sudo /Users/travis/build/subutai-io/control-center/./build_mac.sh $TRAVIS_BRANCH
    - ls subutai_control_center_bin
    deploy:
    - provider: script
      script: bash upload.sh $TRAVIS_BRANCH
      skip_cleanup: true
      on:
        branch: dev
    - provider: script
      script: bash upload.sh $TRAVIS_BRANCH
      skip_cleanup: true
      on:
        branch: master
    - provider: script
      script: bash upload.sh HEAD
      skip_cleanup: true
      on:
        tags: true
